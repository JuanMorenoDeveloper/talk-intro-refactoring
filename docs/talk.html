<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>Introducción a Refactoring</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js-3.7.0/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="theme/ude.css" id="theme" /><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" /><link href="theme/highlightjs-theme/github.css" rel="stylesheet" /><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js-3.7.0/css/print/pdf.css" : "reveal.js-3.7.0/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="reveal.js-3.7.0/lib/js/html5shiv.js"></script><![endif]--></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Introducción a Refactoring</h1><div class="preamble"><script type="text/javascript">
    window.addEventListener("load", function() {

        revealDiv = document.querySelector("body div.reveal")
        footer = document.getElementById("schauderhaft-footer");
        revealDiv.appendChild(footer);

    } );
</script>
<div id="schauderhaft-footer" class="footer">
    <span class="element"></span>
    <span class="element"></span>
    <span class="element">Intro Refactoring</span>
</div>
<aside class="notes"><div class="paragraph"><p>Contenido de la presentación:</p></div>
<div class="ulist"><ul><li><p>Secciones teóricas:</p><div class="ulist"><ul><li><p>Código legacy</p></li><li><p>Razones para cambiar un software.</p></li><li><p>Testing</p></li><li><p>Algoritmo para cambiar código legacy</p></li><li><p>Herramientas</p></li><li><p>Sprout Method</p></li><li><p>Sprout Class</p></li><li><p>Wrap Method</p></li><li><p>Wrap Class</p></li></ul></div></li><li><p>Sección práctica:</p><div class="ulist"><ul><li><p>Sprout Method</p></li><li><p>Sprout Class</p></li></ul></div></li></ul></div></aside></div></section>
<section id="_contenido"><h2>Contenido</h2><div class="ulist"><ul><li><p>Fundamentos</p></li><li><p>¿Cómo cambiar código legacy?</p></li><li><p>Herramientas</p></li><li><p>Técnicas</p></li></ul></div></section>
<section id="_todos_tenemos_buenas_intenciones"><h2>Todos tenemos buenas intenciones</h2></section>
<section data-background-image="images/good-intentions1.jpg" data-background-size="auto"></section>
<section id="_pero"><h2>Pero&#8230;&#8203;</h2></section>
<section data-background-image="images/good-intentions2.jpg" data-background-size="auto"></section>
<section id="_código_legacy"><h2>Código legacy</h2></section>
<section data-background-image="images/legacy-code.jpeg" data-background-size="auto"></section>
<section id="_qué_es_código_legacy"><h2>¿Qué es código legacy? <span class="icon"><i class="fa fa-lightbulb"></i></span></h2><div class="ulist"><ul><li><p>¿Código de "otros"?</p></li><li><p>¿Código díficil de entender?</p></li><li><p>¿Código díficil de mantener?</p></li><li><p>&#8230;&#8203;</p></li></ul></div></section>
<section><div class="quoteblock"><blockquote><div class="paragraph"><p>Código legacy es código sin tests.</p></div></blockquote></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>(2004) M. Feather</p></div></blockquote></div>
<aside class="notes"><div class="paragraph"><p>Código sin pruebas es código malo (bad code). No importa lo bien escrito que esté; no importa lo bonito que esté u orientado a objetos o bien encapsulado. Con las pruebas, podemos cambiar el comportamiento de nuestro código de forma rápida y verificable. Sin ellos, realmente no sabemos si nuestro código está mejorando o empeorando.</p></div></aside></section>
<section id="_razones_para_cambiar_un_software"><h2>Razones para cambiar un software</h2><div class="olist arabic"><ol class="arabic"><li><p>Agregar una feature</p></li><li><p>Reparar un bug</p></li><li><p>Mejorar el diseño</p></li><li><p>Optimizar el uso de recursos</p></li></ol></div>
<aside class="notes"><div class="ulist"><ul><li><p>El comportamiento es lo más importante en el software. Es de lo que dependen los usuarios.
A los usuarios les gusta cuando agregamos comportamiento(features) (siempre que sea lo que realmente querían), pero si cambiamos o eliminamos el comportamiento del que dependen (introducimos errores), dejan de confiar en nosotros.</p></li><li><p>El acto de mejorar el diseño sin cambiar su comportamiento se llama refactorización (refactoring).</p></li><li><p>El refactoring esta enfocado en la estructura del programa.</p></li><li><p>La optimización se enfoca en el uso de recursos.</p></li></ul></div></aside></section>
<section><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:16.6666%" /><col style="width:16.6666%" /><col style="width:16.6666%" /><col style="width:16.6666%" /><col style="width:16.6666%" /><col style="width:16.667%" /></colgroup><tbody><tr><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Adding a Feature</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Fixing a Bug</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Refactoring</strong></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Optimizing</strong></p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Structure</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Changes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Changes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Changes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Functionality</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Changes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Changes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td><td class="tableblock halign-left valign-top"></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Resource Usage</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Changes</p></td><td class="tableblock halign-left valign-top"></td></tr></table>
<aside class="notes"><div class="paragraph"><p>Preservar el comportamiento existente es uno de los mayores desafíos en el desarrollo de software. Incluso cuando estamos cambiando las características básicas, a menudo tenemos áreas muy grandes de comportamiento que debemos preservar.</p></div></aside></section>
<section id="_riesgos_del_cambio"><h2>Riesgos del cambio</h2><div class="olist arabic"><ol class="arabic"><li><p>¿Cuáles cambios tenemos que hacer?</p></li><li><p>¿Cómo sabremos que los cambios fueron hechos correctamente?</p></li><li><p>¿Cómo sabremos que no hemos roto nada?</p></li></ol></div></section>
<section id="_edit_and_pray"><h2>Edit and Pray</h2><div class="paragraph"><p>¿Estándar de la industria?</p></div></section>
<section id="_cover_and_modify"><h2>Cover and Modify</h2><div class="paragraph"><p><strong>Tests</strong></p></div>
<aside class="notes"><div class="paragraph"><p>Cuando tenemos tests que detectan cambios, es como tener una visión de nuestro código. El comportamiento del código es fijo en su lugar. Cuando hacemos cambios, podemos saber que estamos cambiando solo una parte del comportamiento a la vez. En resumen, estamos en control de nuestro trabajo.</p></div></aside></section>
<section id="_muchas_dependencias" data-background-image="images/invoice-example.png" data-background-size="auto"><h2>¿Muchas dependencias?</h2>
<aside class="notes"><div class="paragraph"><p>Las dependencias son uno de los problemas más críticos en el desarrollo de software. Buena parte del trabajo con el código legacy implica romper las dependencias para que el cambio sea más fácil.</p></div></aside></section>
<section id="_el_dilema_del_código_legacy"><h2>El dilema del código legacy</h2><div class="paragraph"><p>Cuando cambiemos el código, deberíamos tener pruebas en su lugar. Para realizar pruebas, a menudo tenemos que cambiar el código.</p></div></section>
<section id="_rompiendo_dependencias" data-background-image="images/invoice-dependency-broken.png" data-background-size="auto"><h2>Rompiendo dependencias</h2>
<aside class="notes"><div class="paragraph"><p>Cuando se rompen dependencias en código legacy, a menudo tiene que suspender un poco su sentido de la estética. Algunas dependencias se rompen limpiamente; Otros terminan pareciendo menos ideales desde el punto de vista del diseño. Son como los puntos de incisión en la cirugía: es posible que quede una cicatriz en su código después de su trabajo, pero todo lo que esté debajo puede mejorar.</p></div></aside></section>
<section id="_el_algoritmo_para_cambiar_código_legacy"><h2>El algoritmo para cambiar código legacy</h2><div class="olist arabic"><ol class="arabic"><li><p>Identificar puntos de cambio.</p></li><li><p>Encontrar puntos de test.</p></li><li><p>Romper dependencias.</p></li><li><p>Escribir tests.</p></li><li><p>Hacer cambios y refactorizar.</p></li></ol></div></section>
<section id="_herramientas"><h2>Herramientas</h2><div class="ulist"><ul><li><p>IDEs</p></li><li><p>Frameworks de Unit Test</p></li></ul></div></section>
<section id="_técnicas"><h2>Técnicas</h2></section>
<section id="_no_tengo_mucho_tiempo_y_necesito_cambiar_el_código"><h2>No tengo mucho tiempo y necesito cambiar el código</h2><aside class="notes"><div class="ulist"><ul><li><p>Sucede en algún lugar todos los días *
Tu jefe entra y dice: "Los clientes quieren una nueva característica. ¿Podemos hacerlo hoy?</p></li></ul></div>
<div class="paragraph"><p>"No lo sé."</p></div>
<div class="paragraph"><p>Miras a tu alrededor. ¿Hay testing en el lugar? No.</p></div>
<div class="paragraph"><p>Preguntamos: "¿Qué tanto lo necesitan?"</p></div>
<div class="paragraph"><p>Sabemos que podemos hacer los cambios de unas líneas en 10 lugares, y quedaría para las 17:00h.
¿Es una emergencia?
¿Se puede arreglar mañana?
El código es nuestra casa, y tenemos que vivir en ella.</p></div></aside></section>
<section id="_sprout_method"><h2>Sprout method</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">//Código original
public class TransactionGate {
  public void postEntries(List entries) {
    for (Iterator it = entries.iterator(); it.hasNext(); ) {
      Entry entry = (Entry)it.next();
      entry.postDate();
    }
    transactionBundle.getListManager().add(entries);
  }
  //...
}</code></pre></section>
<section id="_agregar_feature"><h2>Agregar feature</h2><div class="paragraph"><p>Verificar las nuevas entradas no estén previamente en <code>transactionBundle</code></p></div></section>
<section id="_se_puede_implementar_fácilmente_con"><h2>Se puede implementar "fácilmente" con</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">public class TransactionGate {
  public void postEntries(List entries) {
    List entriesToAdd = new LinkedList();
    for (Iterator it = entries.iterator(); it.hasNext(); ) {
      Entry entry = (Entry)it.next();
      if (!transactionBundle.getListManager().hasEntry(entry) {
        entry.postDate();
        entriesToAdd.add(entry);
      }
    }
    transactionBundle.getListManager().add(entriesToAdd);
  }
  //...
}</code></pre></section>
<section id="_pero_volvemos_a_caer_en_el_ciclo_de_código_legacy_probemos_ahora_el_sprout_method"><h2>Pero volvemos a caer en el ciclo de código legacy. Probemos ahora el Sprout method.</h2></section>
<section id="_extrayendo_lógica_a_método"><h2>Extrayendo lógica a método</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">public class TransactionGate {
//...
  List uniqueEntries(List entries) {
    List result = new ArrayList();
    for (Iterator it = entries.iterator(); it.hasNext(); ) {
      Entry entry = (Entry)it.next();
      if (!transactionBundle.getListManager().hasEntry(entry) {
          result.add(entry);
      }
    }
    return result;
  }
//...
}</code></pre></section>
<section id="_funcionalidad_incorporada"><h2>Funcionalidad incorporada</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">public class TransactionGate{
//...
  public void postEntries(List entries) {
    List entriesToAdd = uniqueEntries(entries);
    for (Iterator it = entriesToAdd.iterator(); it.hasNext(); ) {
      Entry entry = (Entry)it.next();
      entry.postDate();
    }
    transactionBundle.getListManager().add(entriesToAdd);
  }
//...
}</code></pre></section>
<section id="_implementando_el_método_sprout"><h2>Implementando el método sprout</h2><div class="olist arabic"><ol class="arabic"><li><p>Identificar</p></li><li><p>Agregar la referencia en el código</p></li><li><p>Entradas y salidas como argumentos</p></li><li><p>Identificar valores de retorno</p></li><li><p>Implementación del método vía TDD</p></li><li><p>Eliminar comentario y habilitar la llamada.</p></li></ol></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Identifique dónde necesita cambiar su código.</p></li><li><p>Si el cambio se puede formular como una secuencia única de declaraciones en un lugar en un método, escriba una llamada para un nuevo método que hará el trabajo involucrado y luego coméntelo. (Hacer esto incluso antes de escribir el método para poder tener una idea de cómo se verá el llamado del método en el contexto).</p></li><li><p>Determine qué variables locales necesita del método de origen y conviértalos en argumentos para la llamada.</p></li><li><p>Determine si el método sprout deberá devolver los valores al método de origen. Si es así, cambie la llamada para que su valor de retorno se asigne a una variable.</p></li><li><p>Desarrollar el método sprout de utilizando TDD.</p></li><li><p>Elimine el comentario en el método de origen para habilitar la llamada.</p></li></ol></div></aside></section>
<section id="_ventajas_del_método_sprout"><h2>Ventajas del método sprout</h2><div class="ulist"><ul><li><p>Clara separación entre el código anterior y el nuevo.</p></li><li><p>Se pueden identificar las variables afectadas.</p></li><li><p>El nuevo método incluye tests.</p></li></ul></div></section>
<section id="_desventajas_del_método_sprout"><h2>Desventajas del método sprout</h2><div class="ulist"><ul><li><p>Puede dejar el método original en un estado raro (invocaciones a funciones externas).</p></li><li><p>Puede dejar el código en un limbo (El nuevo método puede no estar asociado a la responsabilidad del código original)</p></li></ul></div></section>
<section id="_sprout_class"><h2>Sprout class</h2><pre class="highlight listingblock"><code data-noescape="" class="cpp language-cpp">std::string QuarterlyReportGenerator::generate() {
  std::vector&lt;Result&gt; results = database.queryResults(
  beginDate, endDate);
  std::string pageText;
  pageText += "&lt;html&gt;&lt;head&gt;&lt;title&gt;"
    "Quarterly Report"
    "&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;";
  if (results.size() != 0) {
    for (std::vector&lt;Result&gt;::iterator it = results.begin();it != results.end();++it) {
      pageText += "&lt;tr&gt;";
      pageText += "&lt;td&gt;" + it-&gt;department + "&lt;/td&gt;";
      pageText += "&lt;td&gt;" + it-&gt;manager + "&lt;/td&gt;";
      char buffer [128];
      sprintf(buffer, "&lt;td&gt;$%d&lt;/td&gt;", it-&gt;netProfit / 100);
      pageText += std::string(buffer);
      sprintf(buffer, "&lt;td&gt;$%d&lt;/td&gt;", it-&gt;operatingExpense / 100);
      pageText += std::string(buffer);
      pageText += "&lt;/tr&gt;";
    }
  } else {
    pageText += "No results for this period";
  }
  pageText += "&lt;/table&gt;";
  pageText += "&lt;/body&gt;";
  pageText += "&lt;/html&gt;";
  return pageText;
}</code></pre></section>
<section id="_agregar_feature_2"><h2>Agregar feature</h2><div class="paragraph"><p>Agregar una cabecera al listado del tipo</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="html language-html">&lt;tr&gt;&lt;td&gt;Department&lt;/td&gt;&lt;td&gt;Manager&lt;/td&gt;&lt;td&gt;Profit&lt;/td&gt;&lt;td&gt;Expenses&lt;/td&gt;&lt;/tr&gt;</code></pre></section>
<section id="_extrayendo_lógica_a_clase"><h2>Extrayendo lógica a clase</h2><pre class="highlight listingblock"><code data-noescape="" class="cpp language-cpp">using namespace std;
class QuarterlyReportTableHeaderProducer{
  public:
    string makeHeader();
};

string QuarterlyReportTableProducer::makeHeader(){
  return "&lt;tr&gt;&lt;td&gt;Department&lt;/td&gt;&lt;td&gt;Manager&lt;/td&gt;"
  "&lt;td&gt;Profit&lt;/td&gt;&lt;td&gt;Expenses&lt;/td&gt;";
}</code></pre></section>
<section id="_agregamos_invocación_al_método_original"><h2>Agregamos invocación al método original</h2><pre class="highlight listingblock"><code data-noescape="" class="cpp language-cpp">QuarterlyReportGenerator::generate():
//...
QuarterlyReportTableHeaderProducer producer;
pageText += producer.makeHeader();
//...</code></pre></section>
<section id="_es_en_serio_un_método_para_esto"><h2>¿Es en serio? Un método para esto</h2></section>
<section id="_sí"><h2>Sí</h2></section>
<section id="_permite_hacer_refactoring_adicionales"><h2>Permite hacer refactoring adicionales</h2></section>
<section id="_una_interfaz"><h2>Una interfaz</h2><pre class="highlight listingblock"><code data-noescape="" class="cpp language-cpp">class QuarterlyReportTableHeaderGenerator{
  public:
  string generate();
};</code></pre></section>
<section id="_diferentes_implementaciones"><h2>Diferentes implementaciones</h2><pre class="highlight listingblock"><code data-noescape="" class="cpp language-cpp">class HTMLGenerator{
  public:
    virtual ~HTMLGenerator() = 0;
    virtual string generate() = 0;
};

class QuarterlyReportTableHeaderGenerator : public HTMLGenerator {
  public:
  //...
    virtual string generate();
  //...
};
class QuarterlyReportGenerator : public HTMLGenerator {
  public:
  //...
    virtual string generate();
  //...
};</code></pre></section>
<section id="_otro_ejemplo_filtrando_listas"><h2>Otro ejemplo, filtrando listas</h2><pre class="highlight listingblock"><code data-noescape="" class="vb language-vb">Public Class ManagerProdFin
{
    Public Sub BuscarAltas(ByVal fechadesde As Date, ByVal fechahasta As Date, ByVal solovigentes As Boolean)
    {
        '...
        Dim listaapoderadosaltas = From apo As Apoderados In ListaApoderados Where
        Convert.ToInt32(apo.aponrocuenta) = Convert.ToInt32(obj.NroCliente)
        AndAlso Not apo.apotipodocumento.Equals("UBO")
        AndAlso (Not solovigentes OrElse
        Not apo.apoFechaVencimiento.HasValue()
        OrElse apo.apoFechaVencimiento.Value.CompareTo(fechahasta) &gt; 0) Select apo
        '...
    }
}</code></pre></section>
<section id="_nueva_versión"><h2>Nueva versión</h2><pre class="highlight listingblock"><code data-noescape="" class="vb language-vb">Public Class ManagerProdFin
{
    Public Sub BuscarAltas(ByVal fechadesde As Date, ByVal fechahasta As Date, ByVal solovigentes As Boolean)
    {
    '...
        Dim listatitularesaltas As List(Of Titulares) = New List(Of Titulares)
        listatitularesaltas = AuxManager.titularesvinculados(obj, ListaTitulares)
    '...
    }
}</code></pre></section>
<section id="_la_clase_wrap"><h2>La clase wrap</h2><pre class="highlight listingblock"><code data-noescape="" class="vb language-vb">Public Class ManagerAuxiliar
    Public Sub New()
    End Sub
    Public Function titularesvinculados(ByVal ObjCustomer As Customer_Account,
 ByVal archivotitulares As List(Of Titulares)) As List(Of Titulares)
        Dim archivofiltrado = New List(Of Titulares)
        Dim listafiltrada = From titu As Titulares In archivotitulares
        Where Convert.ToInt32(titu.titubase_no) = ObjCustomer.NroClienteAsInt() Select titu
        For Each T In listafiltrada
            archivofiltrado.Add(T)
        Next
        Return archivofiltrado
    End Function
End Class</code></pre></section>
<section id="_y_el_test"><h2>Y el test</h2><pre class="highlight listingblock"><code data-noescape="" class="vb language-vb">Imports NUnit.Framework

&lt;TestFixture()&gt;
Public Class ManagerAuxiliarUnitTest
    &lt;Test()&gt;
    Public Sub GivenObjCustandtitulares_WhenTvinculados_ThenArchfiltrado()
        Dim AuxiliaryM As ManagerAuxiliar = New ManagerAuxiliar()
        Dim titularesSet As List(Of Titulares) = New List(Of Titulares)
        titularesSet.Add(New Titulares With {.titubase_no = "0000123"})
        titularesSet.Add(New Titulares With {.titubase_no = "0000124"})
        titularesSet.Add(New Titulares With {.titubase_no = "0000125"})
        Dim Customer As Customer_Account = New Customer_Account()
        Customer.campocustacc = "000124"

        Dim result As List(Of Titulares) = AuxiliaryM.titularesvinculados(Customer, titularesSet)

        Assert.That(result, Has.Count().EqualTo(1))
    End Sub
End Class</code></pre></section>
<section id="_implementando_la_clase_sprout"><h2>Implementando la clase sprout</h2><div class="olist arabic"><ol class="arabic"><li><p>Identifique dónde necesita cambiar su código.</p></li><li><p>¿Se puede agrupar en un método? Piense en un nombre de clase e invoque al método. Comente la invocación.</p></li><li><p>Variables y argumentos.</p></li><li><p>Valores de retorno.</p></li><li><p>Desarrolle la clase sprout usando TDD.</p></li><li><p>Elimine el comentario y haga la invocación.</p></li></ol></div>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Identifique dónde necesita cambiar su código.</p></li><li><p>Si el cambio se puede formular como una secuencia única de declaraciones en un lugar en un método, piense en un buen nombre para una clase que podría hacer ese trabajo. Luego, escriba el código que crearía un objeto de esa clase en ese lugar y llame a un método que haga el trabajo que necesita hacer; Luego comenta esas líneas.</p></li><li><p>Determine qué variables locales necesita del método de origen y conviértalos en argumentos para el constructor de las clases.</p></li><li><p>Determine si la clase brotada deberá devolver los valores al método de origen. Si es así, proporcione un método en la clase que proporcionará esos valores y agregue una llamada en el método de origen para recibir esos valores.</p></li><li><p>Desarrolle primero la prueba de la clase de brotes (vea desarrollo dirigido por pruebas)</p></li><li><p>Elimine el comentario en el método de origen para habilitar la creación de objetos y las llamadas.</p></li></ol></div></aside></section>
<section id="_ventajas_de_la_clase_sprout"><h2>Ventajas de la clase sprout</h2><div class="ulist"><ul><li><p>Permite avanzar en el desarrollo con más confianza que si haces cambios invasivos.</p></li></ul></div></section>
<section id="_desventajas_de_la_clase_sprout"><h2>Desventajas de la clase sprout</h2><div class="ulist"><ul><li><p>Complejidad conceptual.</p></li></ul></div></section>
<section id="_wrap_method"><h2>Wrap Method</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">public class Employee{
//...
  public void pay() {
    Money amount = new Money();
    for (Iterator it = timecards.iterator(); it.hasNext(); ) {
      Timecard card = (Timecard)it.next();
      if (payPeriod.contains(date)) {
        amount.add(card.getHours() * payRate);
      }
    }
    payDispatcher.pay(this, date, amount);
  }
}</code></pre></section>
<section id="_agregar_feature_3"><h2>Agregar feature</h2><div class="paragraph"><p>Actualizar un archivo cada vez que se ejecute un pago a los empleados</p></div></section>
<section id="_podemos_agregar_la_funcionalidad_al_final_del_método_pero_que_tal_si"><h2>Podemos agregar la funcionalidad al final del método, pero que tal si&#8230;&#8203;</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">public class Employee {
  private void dispatchPayment() { <i class="conum" data-value="1"></i><b>(1)</b>
    Money amount = new Money();
    for (Iterator it = timecards.iterator(); it.hasNext(); ) {
      Timecard card = (Timecard)it.next();
      if (payPeriod.contains(date)) {
        amount.add(card.getHours() * payRate);
      }
    }
    payDispatcher.pay(this, date, amount);
  }
  public void pay() { <i class="conum" data-value="2"></i><b>(2)</b>
    logPayment(); <i class="conum" data-value="3"></i><b>(3)</b>
    dispatchPayment(); <i class="conum" data-value="4"></i><b>(4)</b>
  }
  private void logPayment() {
    //...
  }
}</code></pre>
<aside class="notes"><div class="olist arabic"><ol class="arabic"><li><p>Renombramos el método original y lo ponemos como privado</p></li><li><p>Creamos un método que mantenga la firma original y se encargue de llamar al método original y a la nueva funcionalidad</p></li></ol></div></aside></section>
<section id="_otra_alternativa_es_mantener_las_dos_funcionalidades"><h2>Otra alternativa es mantener las dos funcionalidades</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">public class Employee {
  public void makeLoggedPayment() {
    logPayment();
    pay();
  }
  public void pay() {
  //...
  }
  private void logPayment() {
  //...
  }
}</code></pre></section>
<section id="_implementando_el_método_wrap_opción_1"><h2>Implementando el método wrap (Opción 1)</h2><div class="olist arabic"><ol class="arabic"><li><p>Identifique el método que necesita cambiar.</p></li><li><p>Si el cambio se hacer como un método independiente, cambie el nombre del método y cree un nuevo método con el mismo nombre y firma que el método anterior.
<strong>Es importante mantener la firma</strong>.</p></li><li><p>Haga la invocación al método antiguo desde el método nuevo.</p></li><li><p>Desarrolle la nueva funcionalidad usando tests, luego haga la llamada desde desde el nuevo método.</p></li></ol></div></section>
<section id="_implementando_el_método_wrap_opción_2"><h2>Implementando el método wrap (Opción 2)</h2><div class="olist arabic"><ol class="arabic"><li><p>Identifique el método que necesita cambiar.</p></li><li><p>Si el cambio se puede formular como una sola secuencia de declaraciones en un solo lugar, desarrolle un nuevo método utilizando tests.</p></li><li><p>Cree otro método que llame al método nuevo y al método antiguo.</p></li></ol></div></section>
<section id="_ventajas_del_método_wrap"><h2>Ventajas del método wrap</h2><div class="ulist"><ul><li><p>A diferencia de los métodos sprout los métodos originales no cambian. Con la técnica sprout se agrega al menos una línea.</p></li><li><p>La nueva funcionalidad es independiente de la funcionalidad existente.</p></li></ul></div></section>
<section id="_desventajas_del_método_wrap"><h2>Desventajas del método wrap</h2><div class="ulist"><ul><li><p>Dificultad para nombrado de los nuevos métodos.</p></li></ul></div>
<div class="quoteblock"><blockquote><div class="paragraph"><p>There are only two hard things in Computer Science: cache invalidation and naming things.&#8201;&#8212;&#8201;Phil Karlton.</p></div></blockquote></div></section>
<section id="_wrap_class_decorator_pattern"><h2>Wrap Class / Decorator pattern</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">class LoggingEmployee extends Employee {
  public LoggingEmployee(Employee e) {
    employee = e;
  }
  public void pay() {
    logPayment();
    employee.pay();
  }
  private void logPayment() {
    //...
  }
  //...
}</code></pre>
<aside class="notes"><p>===
Esta técnica usa el patrón decorator. Creamos objetos de una clase que envuelve a otra clase y los pasamos. La clase que envuelve debe tener la misma interfaz que la clase que está envolviendo para que los clientes no sepan que están trabajando con un envoltorio. En el ejemplo, <code>LoggingEmployee</code> es un decorador para <code>Employee</code>. Debe tener un método de <code>pay()</code> y cualquier otro método de empleado que use el cliente.
===</p></aside></section>
<section id="_wrap_class_sin_decorator_pattern"><h2>Wrap Class / Sin decorator pattern</h2><pre class="highlight listingblock"><code data-noescape="" class="java language-java">class LoggingPayDispatcher {
  private Employee e;
  public LoggingPayDispatcher(Employee e) {
    this.e = e;
  }
  public void pay() {
    employee.pay();
    logPayment();
  }
  private void logPayment() {
    //...
  }
  //...
}</code></pre>
<aside class="notes"><p>===
La clave de la Wrap Class es que se puede agregar un nuevo comportamiento a un sistema sin agregarlo a una clase existente. Cuando hay muchas llamadas al código que se desea envolver, a menudo vale la pena moverse hacia un envoltorio que use el patrón decorator.
Cuando usa el patrón decorator, se puede agregar de manera transparente un nuevo comportamiento a un conjunto de llamadas existentes, como <code>pay()</code>, todo al mismo tiempo.
===</p></aside></section>
<section id="_implementando_la_wrap_class_opción_1_12"><h2>Implementando la Wrap Class (Opción 1) 1/2</h2><div class="olist arabic"><ol class="arabic"><li><p>Identifique un método donde necesita hacer un cambio.</p></li><li><p>Si el cambio como un método independiente, cree una clase que acepte la clase que se va a modificar como un argumento de constructor.</p></li><li><p>Cree un método en esa clase, utilizando tests, e implemente la nueva funcionalidad. Escriba otro método que llame al método nuevo y al método antiguo en la Wrap class.</p></li><li><p>Cree una instancia de la Wrap class en el lugar donde se necesita habilitar la nueva funcionalidad.</p></li></ol></div></section>
<section id="_tips_para_usar_la_wrap_class"><h2>Tips para usar la Wrap Class</h2><div class="olist arabic"><ol class="arabic"><li><p>El comportamiento que quiero agregar es completamente independiente, y no quiero <strong>contaminar</strong> la clase existente con un comportamiento de bajo nivel o no relacionado.</p></li><li><p>La clase ha crecido tanto que realmente no puedo tolerar ponerla peor. En un caso como este, se crea el wrap solo a manera de base para cambios posteriores.</p></li></ol></div></section>
<section id="_hay_más_técnicas"><h2>¿Hay más técnicas?</h2></section>
<section id="_sí_2"><h2>Sí</h2></section>
<section id="_conclusiones"><h2>Conclusiones</h2><div class="ulist"><ul><li><p>Trabajar con código legacy es difícil</p></li><li><p>Los tests son necesarios</p></li><li><p>Cuando no se puede prevenir la enfermedad, se tiene que tratar</p></li><li><p>Las aplicación de estás técnicas depende del contexto</p></li><li><p>La idea de estás técnicas es apoyarlas con test unitarios, sin aplicar test solo se agrega más código legacy</p></li></ul></div></section>
<section><div class="ulist"><ul><li><p>Fuentes:</p><div class="ulist"><ul><li><p>Working Effectively with Legacy Code, 1st. Michael Feathers (2004)</p></li><li><p><a href="http://xurxodev.com/trabajando-con-codigo-legado/" class="bare">http://xurxodev.com/trabajando-con-codigo-legado/</a></p></li><li><p><a href="http://xurxodev.com/trabajando-con-codigo-legado-sprout-method-y-sprout-class/" class="bare">http://xurxodev.com/trabajando-con-codigo-legado-sprout-method-y-sprout-class/</a></p></li><li><p><a href="https://www.yegor256.com/2016/01/26/defensive-programming.html" class="bare">https://www.yegor256.com/2016/01/26/defensive-programming.html</a></p></li></ul></div></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Para generar pdf incluir al final de la presentación lo siguiente: ?showNotes=separate-page&amp;print-pdf</p></div></aside></section></div></div><script src="reveal.js-3.7.0/lib/js/head.min.js"></script><script src="reveal.js-3.7.0/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1280,
  height: 720,

  // Factor of the display size that should remain empty around the content
  margin: 0,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.7.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js-3.7.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal.js-3.7.0/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js-3.7.0/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script></body></html>